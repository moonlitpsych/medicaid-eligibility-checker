# 🎯 Multi-Role Eligibility System - Complete Testing Guide\n\n## 🚀 Quick Start\n\n### Prerequisites\n- Node.js 18+ installed\n- Office Ally credentials configured\n- Both apps running locally\n\n### 1. Start the Eligibility Checker API\n```bash\ncd /Users/macsweeney/medicaid-eligibility-checker\n\n# Install dependencies\nnpm install\n\n# Set environment variables\ncp .env.example .env\n# Edit .env with your Office Ally credentials:\n# OFFICE_ALLY_USERNAME=moonlit\n# OFFICE_ALLY_PASSWORD=your_password\n\n# Start the API server\nnode api-server.js\n```\n\n### 2. Start the Frontend\n```bash\n# In a new terminal\ncd /Users/macsweeney/medicaid-eligibility-checker\n\n# Start the Vue.js frontend\nnpm run dev\n```\n\n### 3. Start moonlit-scheduler (Optional)\n```bash\n# In a new terminal\ncd /Users/macsweeney/moonlit-scheduler\n\n# Install dependencies\nnpm install\n\n# Set environment variables\necho \"ELIGIBILITY_API_URL=http://localhost:3000\" >> .env.local\necho \"NEXT_PUBLIC_ELIGIBILITY_API_URL=http://localhost:3000\" >> .env.local\n\n# Start the Next.js app\nnpm run dev\n```\n\n### 4. Access Points\n- **Multi-Role Interface**: http://localhost:5173\n- **API Server**: http://localhost:3000\n- **moonlit-scheduler**: http://localhost:3001\n- **Health Check**: http://localhost:3000/health\n\n---\n\n## 🧪 Comprehensive Testing Protocol\n\n### Automated Test Suite\n```bash\n# Run the complete multi-role test suite\nnode test-multi-role-system.js\n```\n\n### Manual Testing by Use Case\n\n## 📋 **USE CASE A: Patient Self-Service Booking**\n\n### Scenario 1: Successful Coverage Verification\n**Test Data:** Jeremy Montoya (from CLAUDE.md)\n- **Name**: Jeremy Montoya\n- **DOB**: 07/17/1984\n- **Insurance**: Utah Medicaid\n- **Member ID**: UT123456789 (mock)\n\n**Testing Steps:**\n1. Go to http://localhost:5173\n2. Select **\"Patient Portal\"** role\n3. Fill out the patient eligibility form:\n   - First Name: Jeremy\n   - Last Name: Montoya\n   - Date of Birth: 1984-07-17\n   - Insurance Type: Select \"Utah Medicaid\"\n   - Insurance Name: Utah Medicaid\n   - Member ID: UT123456789\n   - Email: jeremy.montoya@example.com\n   - Phone: (801) 555-0123\n4. Click **\"Check My Insurance Coverage\"**\n\n**Expected Results:**\n- ✅ Coverage verification completes in <1 second\n- ✅ Shows \"Great news! We can help you with your mental healthcare\"\n- ✅ Network Status: \"In-Network\" \n- ✅ \"Book My Appointment\" button appears\n- ✅ Integration with moonlit-scheduler works\n\n### Scenario 2: Coverage Not Verified\n**Test Data:** Use a different name/DOB combination\n\n**Expected Results:**\n- ⚠️ \"We want to help you\" message appears\n- ⚠️ Shows self-pay options\n- ⚠️ Provides alternative resources\n\n---\n\n## 💼 **USE CASE B: Case Manager Assistance Portal**\n\n### Scenario 1: Case Manager Managing Multiple Patients\n**Access:** Select \"Case Manager\" role in the interface\n\n**Testing Steps:**\n1. **Quick Eligibility Check**:\n   - Use Jeremy Montoya data in quick check form\n   - Verify results appear immediately\n   - Click \"+ Add to My Cases\"\n\n2. **Bulk Patient Upload**:\n   - Create a CSV file with patient data:\n     ```csv\n     First Name,Last Name,DOB,Medicaid ID\n     Sarah,Johnson,1985-03-15,UT987654321\n     Michael,Chen,1992-07-22,UT456789123\n     Jennifer,Martinez,1978-11-08,UT789123456\n     ```\n   - Upload via \"Upload patient list (CSV/Excel)\" section\n   - Click \"Process\" and verify batch processing\n\n3. **Case Management**:\n   - Review \"Active Cases\" table\n   - Test \"View\", \"Schedule\", \"Re-check\" buttons\n   - Verify filtering and search functionality\n\n**Expected Results:**\n- ✅ Quick checks work for individual patients\n- ✅ Bulk processing handles multiple patients\n- ✅ Case management interface is functional\n- ✅ Case managers can proceed even with unverified coverage\n- ✅ Role-specific guidance appears\n\n### Scenario 2: Case Manager Third-Party Booking\n**Testing Steps:**\n1. Go to moonlit-scheduler booking flow\n2. In Insurance Info view, check \"I'm booking this appointment for someone else\"\n3. Select \"Case manager\" radio button\n4. Fill out patient information (use Jeremy Montoya data)\n5. Notice eligibility verification is optional for case managers\n6. Complete booking process\n\n**Expected Results:**\n- ✅ Case manager mode detected\n- ✅ Different validation rules applied\n- ✅ Can proceed without mandatory verification\n- ✅ Appropriate guidance messages shown\n\n---\n\n## 🏥 **USE CASE C: Admin/Staff Same-Day Verification**\n\n### Scenario 1: Urgent Same-Day Verification\n**Access:** Select \"Staff/Admin\" role in the interface\n\n**Testing Steps:**\n1. In \"Same-Day Verification\" section:\n   - First Name: Jeremy\n   - Last Name: Montoya\n   - DOB: 1984-07-17\n   - Medicaid ID: UT123456789\n   - Appointment Type: Initial Consultation\n   - ✅ Check \"🚨 Urgent - Patient waiting in clinic\"\n2. Click \"🚨 URGENT VERIFY\"\n\n**Expected Results:**\n- ✅ Response time < 2 seconds (urgent priority)\n- ✅ Clear \"COVERED - Proceed with Appointment\" or \"NOT COVERED\" message\n- ✅ Quick action buttons appear\n- ✅ Result automatically saved to patient record\n\n### Scenario 2: Batch Processing Today's Schedule\n**Testing Steps:**\n1. Review \"Today's Schedule\" preview\n2. Click \"Verify All Today's Appointments\"\n3. Watch batch progress indicator\n4. Verify all appointments get verified status\n\n**Expected Results:**\n- ✅ Batch processing completes efficiently\n- ✅ Progress indicator shows real-time updates\n- ✅ All appointments marked as verified\n- ✅ Statistics update (verified count, etc.)\n\n### Scenario 3: Staff Integration with moonlit-scheduler\n**Testing Steps:**\n1. Staff member uses moonlit-scheduler booking flow\n2. Insurance verification happens in background\n3. Eligibility data automatically populates\n4. Booking continues seamlessly\n\n---\n\n## 🔗 Integration Testing\n\n### Cross-System Communication\n1. **medicaid-eligibility-checker ↔ moonlit-scheduler**\n   - Start patient booking in medicaid-eligibility-checker\n   - Click \"Book My Appointment\"\n   - Verify data transfers to moonlit-scheduler\n   - Complete booking process\n\n2. **API Integration Testing**\n   ```bash\n   # Test direct API calls\n   curl -X POST http://localhost:3000/api/medicaid/check \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\n       \"first\": \"Jeremy\",\n       \"last\": \"Montoya\", \n       \"dob\": \"1984-07-17\",\n       \"medicaidId\": \"UT123456789\"\n     }'\n   \n   # Test moonlit integration API\n   curl -X POST http://localhost:3001/api/eligibility/check \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\n       \"first\": \"Jeremy\",\n       \"last\": \"Montoya\",\n       \"dob\": \"1984-07-17\",\n       \"medicaidId\": \"UT123456789\",\n       \"bookingContext\": {\"role\": \"patient\"}\n     }'\n   ```\n\n---\n\n## 📊 Performance Testing\n\n### Load Testing\n```bash\n# Install artillery for load testing\nnpm install -g artillery\n\n# Create artillery config (artillery.yml):\nconfig:\n  target: 'http://localhost:3000'\n  phases:\n    - duration: 60\n      arrivalRate: 5\nscenarios:\n  - name: \"Eligibility Check\"\n    requests:\n      - post:\n          url: \"/api/medicaid/check\"\n          json:\n            first: \"Jeremy\"\n            last: \"Montoya\"\n            dob: \"1984-07-17\"\n            medicaidId: \"UT123456789\"\n\n# Run load test\nartillery run artillery.yml\n```\n\n### Response Time Benchmarks\n- **Patient Self-Service**: < 1 second average\n- **Case Manager Portal**: < 1.5 seconds average\n- **Admin Urgent Verification**: < 2 seconds\n- **Batch Processing**: < 500ms per patient\n\n---\n\n## 🎨 User Experience Testing\n\n### Visual/UI Testing Checklist\n- [ ] All three role interfaces load properly\n- [ ] Role switching works seamlessly\n- [ ] Loading states are intuitive\n- [ ] Success/error messages are clear\n- [ ] Mobile responsiveness works\n- [ ] Accessibility features function\n- [ ] Brand consistency (moonlit colors/fonts)\n\n### User Flow Testing\n- [ ] Patient can complete end-to-end booking\n- [ ] Case manager can manage multiple patients\n- [ ] Staff can handle urgent same-day verifications\n- [ ] Error handling is graceful\n- [ ] Help resources are accessible\n\n---\n\n## 🐛 Common Issues & Troubleshooting\n\n### API Connection Issues\n```bash\n# Check if API server is running\ncurl http://localhost:3000/health\n\n# Check Office Ally credentials\necho $OFFICE_ALLY_USERNAME\necho $OFFICE_ALLY_PASSWORD\n\n# Check logs for errors\ntail -f api-server.log\n```\n\n### Frontend Issues\n```bash\n# Clear browser cache\n# Hard refresh (Cmd+Shift+R)\n\n# Check console for JavaScript errors\n# Open Developer Tools → Console\n\n# Verify API calls in Network tab\n```\n\n### Integration Issues\n```bash\n# Verify environment variables\ncat .env.local\n\n# Test cross-origin requests\ncurl -H \"Origin: http://localhost:5173\" \\\n     -H \"Access-Control-Request-Method: POST\" \\\n     -X OPTIONS http://localhost:3000/api/medicaid/check\n```\n\n---\n\n## ✅ Success Criteria\n\n### Functional Requirements\n- [ ] All three use cases work end-to-end\n- [ ] Real patient data (Jeremy Montoya) verifies successfully\n- [ ] Role-based permissions are enforced\n- [ ] Cross-system integration functions\n- [ ] Error handling is robust\n\n### Performance Requirements\n- [ ] Response times meet benchmarks\n- [ ] System handles concurrent users\n- [ ] Batch processing scales appropriately\n- [ ] UI remains responsive under load\n\n### User Experience Requirements\n- [ ] Interfaces are intuitive and professional\n- [ ] Workflows are seamless between roles\n- [ ] Error messages are helpful\n- [ ] Help resources are accessible\n- [ ] Mobile experience is acceptable\n\n---\n\n## 📈 Monitoring & Analytics\n\n### Key Metrics to Track\n- Eligibility verification success rate\n- Average response times by role\n- User conversion (verification → booking)\n- Error rates and types\n- Usage patterns by role\n\n### Logging\nAll requests are logged with:\n- Timestamp\n- User role\n- Patient data (anonymized)\n- Response time\n- Success/failure status\n- Error details (if any)\n\n---\n\n## 🚀 Production Deployment Checklist\n\n### Environment Setup\n- [ ] Production Office Ally credentials\n- [ ] Database configured\n- [ ] SSL certificates installed\n- [ ] Environment variables set\n- [ ] CORS configured properly\n\n### Security\n- [ ] API rate limiting enabled\n- [ ] Input validation comprehensive\n- [ ] Sensitive data encrypted\n- [ ] Audit logging configured\n- [ ] Access controls implemented\n\n### Monitoring\n- [ ] Health checks configured\n- [ ] Error alerting set up\n- [ ] Performance monitoring enabled\n- [ ] Usage analytics configured\n- [ ] Backup procedures tested\n\nThis completes the comprehensive multi-role eligibility system with full testing coverage for all three use cases!